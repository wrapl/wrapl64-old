RIVA_FILES := [
	file("config.o"),
	file("debug.o"),
	file("directory.o"),
	file("fileset.o"),
	file("libriva.o"),
	file("log.o"),
	file("log2.o"),
	file("main.o"),
	file("memory.o"),
	file("module.o"),
	file("native.o"),
	file("path.o"),
	file("riva.o"),
	file("stringtable.o"),
	file("symbol.o"),
	file("dynamic.o"),
	file("relocate.o"),
	file("exception.o"),
	file("util.o")
]

for File in RIVA_FILES do
	File[GC_LIB]
end

RIVA_CONF := OUT_BIN/"riva.conf"

RIVA_CONF => fun(FileName) do
	var File := open(FileName:string, "w")
	File:write(
'library = \{
	/lib,
	/usr/lib,
	/usr/lib/i386-linux-gnu,
	/usr/local/lib,
	{OUT_LIB}
}

parseargs = true

modules = \{
	Wrapl/Loader
}'
		)
	File:close
end

WRAPL_MODULES[RIVA_CONF]

c_program(RIVA, RIVA_FILES, [GC_LIB])

DEFAULT[RIVA_CONF]